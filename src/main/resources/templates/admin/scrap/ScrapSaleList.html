<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/admin}">
	  
<!-- contents layout:fragment 정의 -->
<th:block layout:fragment="customContents">
	<div class="card prod-p-card bg-c-green card-body">
		<div class="row align-items-center">
			<div class="col">
				<h3 class="m-b-0 text-white">업사이클링 재료 매입 목록 관리 시스템</h3>
				<h5 class="m-b-0 text-white">UPCYCLING BUS : UPBUS CUSTOMERS CONSIGNMENT MANAGEMENT</h5>
			</div>
		</div>
	</div>
	<h1>업사이클링 재료 매입 목록</h1>
	<div class="card table-card">
		<div class="card-header">
			<h5>업사이클링 재료 매입 목록</h5>
			<div class="card-header-right">
				<div class="btn-group card-option">
					<button type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<i class="feather icon-more-horizontal"></i>
					</button>
					<ul class="list-unstyled card-option dropdown-menu dropdown-menu-right">
						<li class="dropdown-item full-card"><a href="#!"><span><i class="feather icon-maximize"></i> maximize</span><span style="display:none"><i class="feather icon-minimize"></i> Restore</span></a></li>
						<li class="dropdown-item minimize-card"><a href="#!"><span><i class="feather icon-minus"></i> collapse</span><span style="display:none"><i class="feather icon-plus"></i> expand</span></a></li>
						<li class="dropdown-item reload-card"><a href="#!"><i class="feather icon-refresh-cw"></i> reload</a></li>
						<li class="dropdown-item close-card"><a href="#!"><i class="feather icon-trash"></i> remove</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="card-body p-0" style="overflow:scroll;height:600px;position:relative;">
			<div class="table-responsive">
				<form th:action="@{ScrapSaleList}" method="get">
				
				<table class="table table-hover m-b-0">
					
						<thead>
							<tr>
								<th>재료 매입 코드</th>
								<th>재료판매신청코드</th>
								<th>마일리지내역코드</th>
								<th>입고일자</th>
								<th>검수일자</th>
								<th>무게</th>
								<th>판매가</th>
								<th>입고여부</th>
								<th>입고확정버튼</th>
							</tr>
						</thead>
						<tbody style="font-size: 20px;">
							<tr th:each="saleList: ${saleList}">
								<td th:text="${saleList.scrapSaleCode}">재료매입코드</td>
								<td th:text="${saleList.scrapRequestCode}">재료판매신청코드</td>
								<td th:text="${saleList.scrapMileageUserListCode}">마일리지내역코드</td>
								<td th:text="${saleList.scrapReceivingDate}">입고일자</td>
								<td th:text="${saleList.scrapInspectionDate}">검수일자</td> <!-- 버튼 누르면 버튼 사라지고 검수 날짜 나왔으면 좋겠다 -->
								<td>
								   <!--<input type="text" style= "margin-bottom: 20px;" class="form-control" placeholder="재료 무게" name="scrapWeight"/>-->
								<div class="col-sm-12">
								    <div class="input-group">
								      <input type="text" class="form-control" id="scrapWeight" th:value="${saleList.scrapWeight}"placeholder="Search for...">
								      <span class="input-group-btn">
								        <button class="btn btn-default" id="weight-approval-action" th:value="#{saleList.scrapWeight}" type="button">입력</button>
								      </span>
								    </div>
								  </div>
								</td>
								<td th:text="${saleList.scrapPrice}"></td>
								<td>
									<span class="scrapStatusAmountText" th:if="${saleList.scrapStatusAmount eq 1}">Y</span>
									<span class="scrapStatusAmountText" th:unless="${saleList.scrapStatusAmount eq 1}">N</span>
								</td>
								<td>
									<input type="hidden" class="scrapStatusAmount" th:value="${saleList.scrapStatusAmount}">
								 	<button th:if="${saleList.scrapStatusAmount eq 1}" th:value="${saleList.scrapSaleCode}" class="btn btn-danger sale-approval-action" type="button">취소</button>
									<button th:unless="${saleList.scrapStatusAmount eq 1}" th:value="${saleList.scrapSaleCode}" class="btn btn-primary sale-approval-action" type="button">승인</button>
								</td>
							</tr>		
						</tbody>
					</table>
				</form>
				</div>
			</div>
		<div class="ps__rail-x" style="left: 0px; bottom: -50px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 50px; height: 415px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 36px; height: 299px;"></div></div></div>
		<!-- 무게 버튼 스크립트 -->
		<script>
		$(function(){
			$('#weight-approval-action').click(function(){
				var btn = $(this);
				var scrapWeight =  $(this).parents('tr').find('#scrapWeight');
				
				
				var scrapSaleCode = $(this).val();
				var request = $.ajax({
					url: "/admin/scrap/scrapWeightApprovalAjax",
					method: "GET",
					data: {scrapSaleCode: scrapSaleCode, scrapWeight : scrapWeight},
					dataType: "json"
				});
				
					request.done(function( data ) {
						var result = data.result;
						scrapWeight.val();
					 
					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					});
				});
			});
		
								
		</script>
		<!-- 승인버튼 스크립트 -->
		<script>
			$(function(){
				$('.sale-approval-action').click(function(){
				var btn = $(this);
				var scrapStatusAmountTextSpan =$(this).parents('tr').find('.scrapStatusAmountText');
				var scrapStatusAmountInput = $(this).parents().children('.scrapStatusAmount');
				
				var scrapStatusAmount = Number(scrapStatusAmountInput.val());
				
				var modifyScrapStatusAmount = 0;
				if(scrapStatusAmount == 0){
					modifyScrapStatusAmount = 1;
				}else{
					modifyScrapStatusAmount = 0;
				}
				
				var scrapSaleCode = $(this).val();
				var request = $.ajax({
					url: "/admin/scrap/scrapSaleApprovalAjax",
					method: "POST",
					data: { scrapSaleCode: scrapSaleCode, scrapStatusAmount : modifyScrapStatusAmount },
					dataType: "json"
				});
				
					request.done(function( data ) {
						var result = data.result;
						if(result > 0){
							if(scrapStatusAmount == 0){	
								btn.addClass('btn-danger').removeClass('btn-primary');
								//버튼 텍스트 '승인 취소'로 바뀜
								btn.text('취소');
								//버튼 클릭시 밸류 값 1로 바꿈
								scrapStatusAmountInput.val(1);
								//승인여부 값이 Y로 바뀜
								scrapStatusAmountTextSpan.text('Y');
							}else{
								btn.addClass('btn-primary').removeClass('btn-danger');
								//버튼 텍스트 '승인'로 바뀜
								btn.text('승인');			
								//버튼 클릭시 밸류 값 0로 바꿈
								scrapStatusAmountInput.val(0);
								//승인여부 값이 N로 바뀜
								scrapStatusAmountTextSpan.text('N');
							}	
						}else{
							if(scrapStatusAmount == 0){								
								alert('승인 변경에 실패 하였습니다.');	
							}else{
								alert('승인취소 변경에 실패 하였습니다.');									
							}								
						}
						
					});
					 
					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					});
				});
			});
		
		</script>
		
	
</th:block>

</html>

